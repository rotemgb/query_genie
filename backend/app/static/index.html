<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>QueryGenie</title>
    <style>
      body { font-family: system-ui, -apple-system, Roboto, Arial; margin: 32px }
      textarea { width: 100%; height: 80px }
      pre { background:#f7f7f7; padding:12px; border-radius:6px }
      table { border-collapse: collapse; width: 100% }
      th, td { border: 1px solid #ddd; padding: 6px }
    </style>
  </head>
  <body>
    <h1>QueryGenie</h1>
    <p>Ask a question about the sample data (e.g., "Show total revenue per genre").</p>
    <textarea id="q">Show total revenue per genre</textarea>
    <button onclick="run()">Run</button>
    <h3>Generated SQL</h3>
    <pre id="sql">(waiting)</pre>
    <h3>Results</h3>
    <div id="results"></div>
    <script>
      async function run(){
        const q = document.getElementById('q').value
        document.getElementById('sql').textContent = 'â€¦'
        document.getElementById('results').innerHTML = ''
        const res = await fetch('/query', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({question: q})
        })
        if(!res.ok){
          const t = await res.text()
          document.getElementById('sql').textContent = 'Error: ' + t
          return
        }
        const j = await res.json()
        document.getElementById('sql').textContent = j.sql
        if(j.results.length === 0){
          document.getElementById('results').textContent = 'No results'
          return
        }
        const cols = Object.keys(j.results[0])
        let html = '<table><thead><tr>'
        for(const c of cols) html += `<th>${c}</th>`
        html += '</tr></thead><tbody>'
        for(const r of j.results){
          html += '<tr>'
          for(const c of cols) html += `<td>${r[c]}</td>`
          html += '</tr>'
        }
        html += '</tbody></table>'
        document.getElementById('results').innerHTML = html
      }
    </script>
  </body>
</html>
